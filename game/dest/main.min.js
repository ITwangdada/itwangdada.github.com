function Bullet(t){this.x=0,this.y=0,this.type=t,this.rotate=0,this.speed=this.type,this.move()}function Cannon(t){this.x=431,this.y=570,this.type=t,this.rotate=0,this.cur=0}function Coin(t){this.type=t,this.x=0,this.y=0,this.cur=0,this.move()}function d2a(t){return t*Math.PI/180}function a2d(t){return 180*t/Math.PI}function rnd(t,e){return parseInt(Math.random()*(e-t)+t)}function loadImage(t,e,n){for(var a=0,i=0;i<t.length;i++)!function(r){var s=new Image;s.onload=function(){JSON[t[r]]=this,a++,a==t.length&&e&&e(),n&&n(a,t.length)},s.src="img/"+t[i]+".png"}(i)}function DieFish(t){this.x=0,this.y=0,this.rotate=0,this.type=t,this.cur=0,this.move()}function Fish(t){this.x=0,this.y=0,this.rotate=0,this.type=t,this.speed=1,this.cur=0,this.move(),this.collR=FISH_SIZE[this.type].collR}function Web(){this.x=0,this.y=0,this.scale=.5}var BULLET_SIZE=[null,{x:86,y:0,w:24,h:26},{x:62,y:0,w:25,h:29},{x:30,y:0,w:31,h:35},{x:32,y:35,w:27,h:31},{x:30,y:82,w:29,h:33},{x:0,y:82,w:30,h:34},{x:0,y:0,w:30,h:44}];Bullet.prototype.draw=function(t){var e=BULLET_SIZE[this.type].x,n=BULLET_SIZE[this.type].y,a=BULLET_SIZE[this.type].w,i=BULLET_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(JSON.bullet,e,n,a,i,-a/2,-i/2,a,i),t.restore()},Bullet.prototype.move=function(){var t=this;setInterval(function(){var e=t.speed*Math.sin(d2a(t.rotate)),n=t.speed*Math.cos(d2a(t.rotate));t.x+=e,t.y-=n},30)};var CANNON_SIZE=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];Cannon.prototype.draw=function(t){var e=CANNON_SIZE[this.type].w,n=CANNON_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(JSON["cannon"+this.type],0,this.cur*n,e,n,-e/2,-n/2,e,n),t.restore()},Cannon.prototype.emitChange=function(){var t=this,e=setInterval(function(){t.cur++,5==t.cur&&(t.cur=0,clearInterval(e))},100)},Coin.prototype.draw=function(t){switch(t.save(),t.translate(this.x,this.y),this.type){case 1:case 2:case 3:t.drawImage(JSON.coinAni1,0,60*this.cur,60,60,-30,-30,60,60);break;case 4:case 5:t.drawImage(JSON.coinAni2,0,60*this.cur,60,60,-30,-30,60,60)}t.restore()},Coin.prototype.move=function(){var t=this;setInterval(function(){t.cur++,10==t.cur&&(t.cur=0)},30),setTimeout(function(){setInterval(function(){t.x+=(0-t.x)/5,t.y+=(650-t.y)/5},30)},300),this.playSong()},Coin.prototype.playSong=function(){var t=new Audio;t.src="snd/coin.wav",t.play()};var JSON={};DieFish.prototype.draw=function(t){var e=FISH_SIZE[this.type].w,n=FISH_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>90&&this.rotate<270&&t.scale(1,-1),t.drawImage(JSON["fish"+this.type],0,4*n+this.cur*n,e,n,-e/2,-n/2,e,n),t.restore()},DieFish.prototype.move=function(){var t=this;setInterval(function(){t.cur++,4==t.cur&&(t.cur=0)},30)};var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];Fish.prototype.draw=function(t){var e=FISH_SIZE[this.type].w,n=FISH_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>90&&this.rotate<270&&t.scale(1,-1),t.drawImage(JSON["fish"+this.type],0,this.cur*n,e,n,-e/2,-n/2,e,n),t.restore()},Fish.prototype.move=function(){var t=this;setInterval(function(){var e=t.speed*Math.cos(d2a(t.rotate)),n=t.speed*Math.sin(d2a(t.rotate));t.x+=e,t.y+=n},30),setInterval(function(){t.cur++,4==t.cur&&(t.cur=0)},150)},Fish.prototype.isIn=function(t,e){var n=t-this.x,a=e-this.y,i=Math.sqrt(n*n+a*a);return i<this.collR?!0:!1},window.onload=function(){var t=document.getElementById("c1"),e=t.getContext("2d"),n=30,a=[-n,t.width+n],i=.02;loadImage(arrResource,function(){var r=new Cannon(7),s=[],o=[],h=[],c=[],l=[];setInterval(function(){if(e.clearRect(0,0,t.width,t.height),Math.random()<i){var u=new Fish(rnd(1,6));a.sort(function(){return Math.random()-.5}),a[0]<0?u.rotate=rnd(-45,45):u.rotate=rnd(135,225),u.x=a[0],u.y=rnd(100,t.height-100),o.push(u)}for(var y=0;y<o.length;y++)o[y].draw(e);e.drawImage(JSON.bottom,0,0,765,70,0,532,765,70);for(var y=0;y<s.length;y++)s[y].draw(e);for(var y=0;y<h.length;y++)h[y].draw(e);for(var y=0;y<c.length;y++)c[y].scale+=.03,c[y].draw(e),c[y].scale>1.2&&(c.splice(y,1),y--);for(var y=0;y<l.length;y++)l[y].draw(e);r.draw(e);for(var y=0;y<o.length;y++)for(var p=0;p<s.length;p++)if(o[y].isIn(s[p].x,s[p].y)){var f=o[y].type,v=o[y].x,w=o[y].y,d=o[y].rotate;o.splice(y,1),y--,s.splice(p,1),p--;var I=new Coin(f);I.x=v,I.y=w,h.push(I);var x=new Web;x.x=v,x.y=w,c.push(x);var g=new DieFish(f);g.x=v,g.y=w,g.rotate=d,l.push(g),setTimeout(function(){l.splice(0,1)},500)}for(var y=0;y<s.length;y++)(s[y].x<-n||s[y].x>t.width+n||s[y].y<-n||s[y].y>t.height+n)&&(s.splice(y,1),y--);for(var y=0;y<o.length;y++)(o[y].x<-n||o[y].x>t.width+n||o[y].y<-n||o[y].y>t.height+n)&&(o.splice(y,1),y--)},16),t.onclick=function(e){var n=new Audio;n.src="snd/cannon.mp3",n.play();var a=r.x-(e.clientX-t.offsetLeft),i=r.y-(e.clientY-t.offsetTop),o=a2d(Math.atan2(i,a))-90;r.rotate=o,r.emitChange();var h=new Bullet(r.type);h.x=r.x,h.y=r.y,h.rotate=r.rotate,s.push(h)}})};var arrResource=["fish1","fish2","fish3","fish4","fish5","bottom","cannon1","cannon2","cannon3","cannon4","cannon5","cannon6","cannon7","bullet","coinAni1","coinAni2","web"];Web.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(JSON.web,15,414,107,107,-53.5,-53.5,107,107),t.restore()};